#
# print UMTS modem status
#
# usage: wwan-status
#

make femtocom

for repeat in 1 2 3 4 5
	do
	if lsusb | fgrep '0af0:8800 Option' >/dev/null
		then # found
		break
	fi
	if [ -w /sys/devices/virtual/gpio/gpio186/value ]
	then # wake up modem in GTA04A4
		echo 1 >/sys/devices/virtual/gpio/gpio186/value
		sleep 1
		echo 0 >/sys/devices/virtual/gpio/gpio186/value
		sleep 5
	fi
	done

for i in $(cd /sys/class/tty/ && echo ttyHS*)
	do
	if [ "$(cat /sys/class/tty/$i/hsotype)" == "Application" ]
		then
		IF="/dev/$i"
	fi
done

[ "$IF" ] || (echo HSO Application interface not found; exit 1)

echo Interface: $IF

(
echo "AT\$QCVOLT"; sleep 1
echo "AT\$QCSIMSTAT?"; sleep 1
echo "AT+CGMI"; sleep 1
echo "AT+CGMM"; sleep 1
echo "AT+CGSN"; sleep 1
echo "AT+CIMI"; sleep 1
echo "AT+CPIN?"; sleep 1
echo "AT+CSQ"; sleep 1
echo "AT_OLCC=1"; sleep 1
echo "AT_OSQI=1"; sleep 1
echo "AT_OWANCALL?"; sleep 1
echo "AT_OWANDATA?"; sleep 1
echo "AT_OWANNWERROR?"; sleep 1
echo "AT_ONCI?"; sleep 1
sleep 60
) | ./femtocom $IF

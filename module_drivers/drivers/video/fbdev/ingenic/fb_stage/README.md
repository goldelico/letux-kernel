## 驱动结构




1. dpu ctrls 最底层硬件操作
2. hwcomposer 封装的合成操作.
3. hwcomp-v4l2 利用composer的功能，导出到v4l2层，支持格式转换，和缩放硬件加速处理。memory to memory.
4. ingenicfb 是标准framebuffer驱动，默认使用的是Simple RDMA 用来搬运数据. 同时实例化了hwcomposer，提供用户接口全功能自定义配置.
5. hwcomp-fb 是利用composer的功能，导出标准framebuffer接口，用户可以单独在某一层上绘图，互不干扰.
	-> 例如： 一层做UI， 一层做视频.
6. sysfs 接口主要是用于快速修改hwcomp-fb的属性，方便用户动态改变layer 属性.


注意事项: hwcomp-v4l2 和 hwcomp-fb 不能同时使用。当有格式转换和合成显示同时存在时，最好先合成到内存，在通过RDMA显示.




```

        ┌───────────────────┐    ┌───────────────┐     ┌──────────────────┐   ┌───────────────┐
        │   v4l2-hwcomp     │    │               │     │                  │   │dynamic ctrl   │
        │   NV12/RGB->RGB   │    │ ioctl ops     │     │ standard fb dev  │   │for export fb  │
        │    scale/csc      │    │               │     │                  │   │               │
        └────────┬──────────┘    └──────┬────────┘     └─────────┬────────┘   └───────┬───────┘
                 │                      │                        │                    │
  ───────────────┼──────────────────────┼────────────────────────┼────────────────────┼─────────
                 │                      │                        │                    │
        ┌────────▼──────────┐   ┌───────▼────────┐     ┌─────────▼────────┐           │
        │                   │   │                │     │                  │    ┌──────▼──────┐
        │                   │   │                │     │                  │    │             │
        │   hwcomp-v4l2     │   │  ingenicfb     │     │  hwcomp-fb       ◄────┤   sysfs     │
        │                   │   │                │     │                  │    │             │
        │                   │   │                │     │                  │    └─────────────┘
        └────────▲──────────┘   └───────▲────────┘     └─────────▲────────┘
                 │                      │                        │
                 │                      │                        │
                 │                      │                        │
                 │                      │                        │
                 │                      │                        │
                 │                      │                        │
                 │        ┌─────────────┴──────────┐             │
                 │        │                        │             │
                 └────────┤     hwcomposer         ├─────────────┘
                          │                        │
                          └────────────┬───────────┘
                                       │
                                       │
           ┌───────────────────────────▼───────────────────────────┐
           │                                                       │
           │                    dpu ctrls                          │
           │                                                       │
           └───────────────────────────────────────────────────────┘

```



